server {
  listen 80;
  server_name <%= value '/config/foreman/hostname' %>;
  root /usr/share/foreman/public;
  passenger_enabled on;
}
server {
  listen 443 ssl;
  client_max_body_size 50M;
  server_name <%= value '/config/foreman/hostname' %>;
  root /usr/share/foreman/public;
  passenger_enabled on;
  ssl on;
  ssl_certificate /var/lib/puppet/ssl/certs/<%= value '/config/puppet/master/hostname' %>.pem;
  ssl_certificate_key /var/lib/puppet/ssl/private_keys/<%= value '/config/puppet/master/hostname' %>.pem;
  ssl_client_certificate /var/lib/puppet/ssl/ca/ca_crt.pem;
  ssl_crl /var/lib/puppet/ssl/ca/ca_crl.pem;
  ssl_verify_client optional;
  ssl_verify_depth 2;
  ssl_session_timeout 10m;
  passenger_env_var HTTPS on;
  passenger_env_var SSL_CLIENT_S_DN $ssl_client_s_dn;
  passenger_env_var SSL_CLIENT_VERIFY $ssl_client_verify;
}
